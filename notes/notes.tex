\documentclass{article}

\title{Notes on navigation history}
\author{%
  Alan Jeffrey
  \and
  Connor G.~Brewster
}
\date{DRAFT of 2016-06-13}

\usepackage{amssymb}
\usepackage{tikz}
\usetikzlibrary{fit}

% Macros, so we can change notation easily
\newcommand{\aNH}{H}
\newcommand{\Docs}{D}
\newcommand{\Active}{A}
\newcommand{\parentOf}{\rightarrow}
\newcommand{\parentOfActive}{\twoheadrightarrow}
\newcommand{\childOf}{\larrow}
\newcommand{\activeChildOf}{\twoheadleftarrow}
\newcommand{\leChron}{\le}
\newcommand{\ltChron}{<}
\newcommand{\geChron}{\ge}
\newcommand{\gtChron}{>}
\newcommand{\eqSess}{\sim}
\newcommand{\ltSess}{\lesssim}
\newcommand{\gtSess}{\gtrsim}
\newcommand{\rootDoc}{d_0}
\newcommand{\aDoc}{d}
\newcommand{\bDoc}{e}
\newcommand{\cDoc}{f}
\newcommand{\st}{\mathbin.}
\newtheorem{goal}{Goal}
\newtheorem{patch}{Patch}
\newtheorem{counterexample}{Counterexample}

\begin{document}

\maketitle

\begin{abstract}
  Some notes on a model of navigation history.
\end{abstract}

\section{Introduction}

[These are rough notes, working towards a model of navigation history for the web.]

\section{Preliminaries}

[Define forest, tree, root, total order, equivalence.]

\section{Model}

A \emph{navigation history} $\aNH=(\Docs,{\parentOf},{\leChron},{\eqSess},\Active)$ consists of:
\begin{itemize}
\item a forest $(\Docs,{\parentOf})$ (the \emph{document hierarchy}),
\item a total order $(\Docs,{\leChron})$ (the \emph{chronological order}),
\item an equivalence relation $(\Docs,{\eqSess})$ (the \emph{same-session equivalence}), and
\item a set $\Active \subseteq \Docs$ (the \emph{active documents}),
\end{itemize}
such that:
\begin{itemize}
\item for every $\aDoc$ there is a unique $\aDoc'\in\Active$ such that $\aDoc \eqSess \aDoc'$,
\item for every $\aDoc \parentOf \bDoc \eqSess \bDoc'$
  we have $\aDoc \parentOf \bDoc'$, and
\item for every $\aDoc \parentOf \bDoc$, we have $\aDoc \leChron \bDoc$.
\end{itemize}
Define:
\begin{itemize}
\item $\rootDoc$ is the unique active root document,
\item $\aDoc \parentOfActive \bDoc$ when $\aDoc \parentOf \bDoc$ and $\bDoc \in \Active$,
\item a document $\aDoc$ is \emph{fully active} whenever $\rootDoc \parentOfActive^* \aDoc$,
\item $\aDoc \ltSess \bDoc$ whenever $\aDoc \eqSess \bDoc$ and $\aDoc \ltChron \bDoc$,
\item the \emph{session future} of $\aDoc$ is $\{ \bDoc \mid \aDoc \ltSess \bDoc \}$,
\item the \emph{session past} of $\aDoc$ is $\{ \bDoc \mid \aDoc \gtSess \bDoc \}$,
\item the \emph{joint session future} is $\{ \bDoc \mid \exists \aDoc \st \rootDoc \parentOfActive^* \aDoc \ltSess \bDoc \}$,
\item the \emph{joint session past} is $\{ \bDoc \mid \exists \aDoc \st \rootDoc \parentOfActive^* \aDoc \gtSess \bDoc \}$,
\end{itemize}
Define \emph{$\aDoc$ in $\aNH$ naviagates to $\aDoc'$ in $\aNH'$} when:
\begin{itemize}
\item $\aDoc\in\Active$ and $\aDoc'\notin\Docs$,
\item $\Docs' = \Docs \cup \{\aDoc'\} \setminus
  \{ \cDoc \mid \exists \bDoc \st \aDoc \ltSess \bDoc \parentOf^* \cDoc \}$,
\item $\bDoc \leChron' \cDoc$ whenever
  $\bDoc \leChron \cDoc$, or $\cDoc = \aDoc'$,
\item $\bDoc \parentOf' \cDoc$ whenever
  $\bDoc \parentOf \cDoc$ and $\cDoc \neq \aDoc$, or
  $\bDoc \parentOf \aDoc$ and $\cDoc = \aDoc'$,
\item $\bDoc \eqSess' \cDoc$ whenever
  $\bDoc \eqSess \cDoc$, or
  $\bDoc \eqSess \aDoc$ and $\cDoc = \aDoc'$, or
  $\aDoc \eqSess \cDoc$ and $\bDoc = \aDoc'$, and
\item $\bDoc \in \Active'$ whenever
  $\aDoc \in \Active$ and $\bDoc=\aDoc'$, or
  $\bDoc \in \Active$ and $\bDoc\ne\aDoc$.
\end{itemize}
Define \emph{$\aNH$ traverses to $\aDoc$ in $\aNH'$} when:
\begin{itemize}
\item $\Docs'$ is $\Docs$,
\item $\leChron'$ is $\leChron$,
\item $\parentOf'$ is $\parentOf$,
\item $\eqSess'$ is $\eqSess$, and
\item $\bDoc\in\Active'$ whenever $\aDoc\not\eqSess\bDoc \in \Active$, or
  $\aDoc=\bDoc$.
\end{itemize}
Define \emph{$\aNH$ goes back by $n$ to $\aNH'$} when:
\begin{itemize}
\item the joint session past of $\aNH$ is $\aDoc_1 \gtChron \cdots \gtChron \aDoc_n \gtChron \cdots$,
\item $H$ traverses to $d_n$ in $H'$
\end{itemize}
Define \emph{$\aNH$ goes forwards by $n$ to $\aNH'$} when:
\begin{itemize}
\item the joint session future of $\aNH$ is $\aDoc_1 \ltChron \cdots \ltChron \aDoc_n \ltChron \cdots$,
\item $H$ traverses to $d_n$ in $H'$
\end{itemize}
[This defn is meant to align with the spec.]
    
\section{Properties}


[State some goals, e.g. go($\delta$);go($\delta'$) is the same as go($\delta+\delta'$),
  navigate;go($-1$) has the same fully active documents as doing nothing,
  session history can be implemented effeciently in memory...]

[I suspect none of these are true of the current spec, can we find a model in which
  they are true?]

\begin{goal}
  If $H$ goes forward by $n$ to $H'$
  and $H'$ goes forward by $n'$ to $H''$
  then $H$ goes forward by $n+n'$ to $H'$.
\end{goal}

\begin{counterexample}
  Let $H$ be:
  \[\begin{tikzpicture}
    \node(0) at (0,0){\bf 0};
    \node(1) at (-2,-1){\bf 1};
    \node(2) at (-1,-1){\rm 2};
    \node(3) at (1,-1){\bf 3};
    \node(4) at (2,-1){\rm 4};
    \node[draw,dotted,fit=(0)] {};
    \node[draw,dotted,fit=(1)(2)] {};
    \node[draw,dotted,fit=(3)(4)] {};    
    \draw[->](0)--(1);
    \draw[->](0)--(3);
  \end{tikzpicture}\]
  which moves forwards by $1$ to:
  \[\begin{tikzpicture}
    \node(0) at (0,0){\bf 0};
    \node(1) at (-2,-1){\rm1};
    \node(2) at (-1,-1){\bf 2};
    \node(3) at (1,-1){\bf 3};
    \node(4) at (2,-1){\rm 4};
    \node[draw,dotted,fit=(0)] {};
    \node[draw,dotted,fit=(1)(2)] {};
    \node[draw,dotted,fit=(3)(4)] {};    
    \draw[->](0)--(2);
    \draw[->](0)--(3);
  \end{tikzpicture}\]
  which in turn moves forwards by $1$ to:
  \[\begin{tikzpicture}
    \node(0) at (0,0){\bf 0};
    \node(1) at (-2,-1){\rm1};
    \node(2) at (-1,-1){\bf 2};
    \node(3) at (1,-1){\rm 3};
    \node(4) at (2,-1){\bf 4};
    \node[draw,dotted,fit=(0)] {};
    \node[draw,dotted,fit=(1)(2)] {};
    \node[draw,dotted,fit=(3)(4)] {};    
    \draw[->](0)--(2);
    \draw[->](0)--(4);
  \end{tikzpicture}\]
  but $H$ goes forward by $2$ to:
  \[\begin{tikzpicture}
    \node(0) at (0,0){\bf 0};
    \node(1) at (-2,-1){\bf 1};
    \node(2) at (-1,-1){\rm 2};
    \node(3) at (1,-1){\rm 3};
    \node(4) at (2,-1){\bf 4};
    \node[draw,dotted,fit=(0)] {};
    \node[draw,dotted,fit=(1)(2)] {};
    \node[draw,dotted,fit=(3)(4)] {};    
    \draw[->](0)--(1);
    \draw[->](0)--(4);
  \end{tikzpicture}\]
\end{counterexample}
%
This counterexample is caused by the definition of `move forwards' which
only traverses one document's session history. Instead, we should traverse
the history of all $n$ documents.

\begin{patch}
Define \emph{$\aNH$ goes forwards by $n$ to $\aNH'$} when:
\begin{itemize}
\item the joint session future of $\aNH$ is $\aDoc_1 \ltChron \cdots \ltChron \aDoc_n \ltChron \cdots$,
\item there is some $\aNH=\aNH_0,\ldots,\aNH_n=\aNH'$, such that
\item $H_{i-1}$ traverses to $d_i$ in $H_i$ for each $1 \le i \le n$.
\end{itemize}
Define \emph{$\aNH$ goes back by $n$ to $\aNH'$} when:
\begin{itemize}
\item the joint session past of $\aNH$ is $\aDoc_1 \gtChron \cdots \gtChron \aDoc_n \gtChron \cdots$,
\item there is some $\aNH=\aNH_0,\ldots,\aNH_n=\aNH'$, such that
\item $H_{i-1}$ traverses to $d_i$ in $H_i$ for each $1 \le i \le n$.
\end{itemize}
\end{patch}
Unfortunately, Goal~\ref{goal:homomorphism} is not satisfied,
even with this patch.
\begin{counterexample}
  Let $H$ be:
  \[\begin{tikzpicture}
    \node(0) at (0,0){\bf 0};
    \node(1) at (-1,-1){\bf 1};
    \node(2) at (1,-1){\rm 2};
    \node(3) at (0,-2){\bf 3};
    \node(4) at (2,-2){\rm 4};
    \node(5) at (3,0){\rm 5};
    \node[draw,dotted,fit=(0)(5)] {};    
    \node[draw,dotted,fit=(1)(2)] {};
    \node[draw,dotted,fit=(3)(4)] {};    
    \draw[->](0)--(1);
    \draw[->](2)--(3);
  \end{tikzpicture}\]
  which moves forwards by $1$ to:
  \[\begin{tikzpicture}
    \node(0) at (0,0){\bf 0};
    \node(1) at (-1,-1){\rm 1};
    \node(2) at (1,-1){\bf 2};
    \node(3) at (0,-2){\bf 3};
    \node(4) at (2,-2){\rm 4};
    \node(5) at (3,0){\rm 5};
    \node[draw,dotted,fit=(0)(5)] {};    
    \node[draw,dotted,fit=(1)(2)] {};
    \node[draw,dotted,fit=(3)(4)] {};    
    \draw[->](0)--(2);
    \draw[->](2)--(3);
  \end{tikzpicture}\]
  which in turn moves forwards by $1$ to:
  \[\begin{tikzpicture}
    \node(0) at (0,0){\bf 0};
    \node(1) at (-1,-1){\rm 1};
    \node(2) at (1,-1){\bf 2};
    \node(3) at (0,-2){\rm 3};
    \node(4) at (2,-2){\bf 4};
    \node(5) at (3,0){\rm 5};
    \node[draw,dotted,fit=(0)(5)] {};    
    \node[draw,dotted,fit=(1)(2)] {};
    \node[draw,dotted,fit=(3)(4)] {};    
    \draw[->](0)--(2);
    \draw[->](2)--(4);
  \end{tikzpicture}\]
  but $H$ goes forward by $2$ to:
  \[\begin{tikzpicture}
    \node(0) at (0,0){\rm 0};
    \node(1) at (-1,-1){\rm 1};
    \node(2) at (1,-1){\bf 2};
    \node(3) at (0,-2){\bf 3};
    \node(4) at (2,-2){\rm 4};
    \node(5) at (3,0){\bf 5};
    \node[draw,dotted,fit=(0)(5)] {};    
    \node[draw,dotted,fit=(1)(2)] {};
    \node[draw,dotted,fit=(3)(4)] {};    
    \draw[->](0)--(2);
    \draw[->](2)--(3);
  \end{tikzpicture}\]
\end{counterexample}
The problem this time is that the definition of `joint session history' only includes
the fully active documents, not all active documents.

\begin{patch}
Define:
\begin{itemize}
\item the \emph{joint session future} is $\{ \bDoc \mid \exists \aDoc \in \Active \st \aDoc \ltSess \bDoc \}$, and
\item the \emph{joint session past} is $\{ \bDoc \mid \exists \aDoc \in \Active \st \aDoc \gtSess \bDoc \}$.
\end{itemize}
\end{patch}

\section{Experiments}

[A write-up of CGB's experiments with how different browsers handle navigation.]

\section{Specification}

[Suggested edits to the spec:
  1. traverse to each document, not just the selected one,
  2. keep all documents in the seession history, not just the fully active ones,
  3. change the session history order.]

\section{Conclusion}

[We did stuff.]

\end{document}
